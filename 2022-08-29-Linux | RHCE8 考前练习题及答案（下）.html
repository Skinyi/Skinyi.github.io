<!DOCTYPE html>
<html  lang="zh-CN,en,default" >
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>RHCE8 考前练习题及答案（下） | Avery Ma 的个人网站</title>
    <meta name="description" content="🔴 此文章由之前的 Typora 笔记迁移过来，内容可能已经过时。  （接上常规题） 修改文件内容 按照下方所述，创建一个名为 &#x2F;home&#x2F;greg&#x2F;ansible&#x2F;issue.yml 的 playbook ：   该 playbook 将在所有清单主机上运行；   该 playbook 会将 &#x2F;etc&#x2F;issue 的内容替换为下方所示的一行文本：  在 dev 主机组中的主机上，这行文本显示">
<meta property="og:type" content="article">
<meta property="og:title" content="RHCE8 考前练习题及答案（下）">
<meta property="og:url" content="https://skinyi.github.io/2022-08-29-Linux%20|%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8B%EF%BC%89.html">
<meta property="og:site_name" content="Avery Ma 的个人网站">
<meta property="og:description" content="🔴 此文章由之前的 Typora 笔记迁移过来，内容可能已经过时。  （接上常规题） 修改文件内容 按照下方所述，创建一个名为 &#x2F;home&#x2F;greg&#x2F;ansible&#x2F;issue.yml 的 playbook ：   该 playbook 将在所有清单主机上运行；   该 playbook 会将 &#x2F;etc&#x2F;issue 的内容替换为下方所示的一行文本：  在 dev 主机组中的主机上，这行文本显示">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-29T15:07:00.394Z">
<meta property="article:modified_time" content="2022-08-30T14:01:20.257Z">
<meta property="article:author" content="skinyi">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="RHEL">
<meta property="article:tag" content="RHCE">
<meta property="article:tag" content="认证考试">
<meta name="twitter:card" content="summary">

    
    <link rel="icon" href="images/favicon.png" type="image/x-icon">

    
<link rel="stylesheet" href="/css/common.min.css">



    
    
    
    
        <link href="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css" rel="stylesheet">
    
    
    
<link rel="stylesheet" href="/css/iconfont.min.css">

    
<meta name="generator" content="Hexo 6.2.0"></head>

    <body>
        <header class="header header-fixture">
    <div class="profile-search-wrap flex sm:block">
        
        
        <div class="profile sm:text-center md:px-1 lg:px-3 sm:pb-4 sm:pt-6">
            <a id="avatar" role="link" href="https://github.com/skinyi" class="inline-block lg:w-16 lg:h-16 w-8 h-8 m-2" target="_blank" rel="noopener" rel="noreferrer" >
                <img src="/images/avatar.jpg" class="rounded-full" alt="avatar">
            </a>
            <h2 id="name" class="hidden lg:block">Avery Ma</h2>
            <h3 id="title" class="hidden xl:block">IT 从业者</h3>
            
            <small id="location" class="hidden lg:block">
                <i class="iconfont icon-map-icon"></i>
                宁夏, 中国
            </small>
            
        </div>
        
        
<div class="search flex-1 flex lg:inline-block sm:hidden lg:px-4 lg:mt-2 lg:w-full">
    <form id="search-form" class="my-auto flex-1 lg:border lg:border-solid lg:border-gray-200">
        <div class="input-group table bg-gray-100 lg:bg-white w-full">
            <input id="search-input" type="text" placeholder="搜索" class="inline-block w-full bg-gray-100 lg:bg-white">
            <span class="table-cell">
                <button name="search tigger button" disabled>
                    <i class="iconfont icon-search m-2"></i>
                </button>
            </span>
        </div>
    </form>
        
<div id="content-json" data-placeholder="搜索" class="invisible hidden">/content.json</div>
<script id="search-teamplate" type="text/html" data-path="/content.json">
    <div>
        <div class="search-header bg-gray-400">
            <input id="actual-search-input" model="keyword" ref="input" class="inline-block w-full h-10 px-2 py-1" placeholder="搜索" type="text">
        </div>
        <div class="search-result bg-gray-200">
            {{#each searchPosts}}
            <a href="/{{ path }}" class="result-item block px-2 pb-3 mb-1 pt-1 hover:bg-indigo-100">
                <i class="iconfont icon-file"></i>
                <h1 class="result-title inline font-medium text-lg">{{ title }}</h1>
                <p class="result-content text-gray-600 text-sm">{{{ text }}}</p>
            </a>
            {{/each}}
        </div>
    </div>
</script>

</div>


        <button name="menu toogle button" id="menu-toggle-btn" class="block sm:hidden p-3" role="button" aria-expanded="false">
            <i class="iconfont icon-hamburger"></i>
        </button>
    </div>
    <nav id="menu-nav" class="hidden sm:flex flex-col">
        
        
            <div class="menu-item menu-home" role="menuitem">
                <a href="/.">
                    <i class="iconfont icon-home" aria-hidden="true"></i>
                    <span class="menu-title">首页</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-archives" role="menuitem">
                <a href="/archives">
                    <i class="iconfont icon-archive" aria-hidden="true"></i>
                    <span class="menu-title">归档</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-categories" role="menuitem">
                <a href="/categories">
                    <i class="iconfont icon-folder" aria-hidden="true"></i>
                    <span class="menu-title">分类</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-tags" role="menuitem">
                <a href="/tags">
                    <i class="iconfont icon-tag" aria-hidden="true"></i>
                    <span class="menu-title">标签</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-repository" role="menuitem">
                <a href="/repository">
                    <i class="iconfont icon-project" aria-hidden="true"></i>
                    <span class="menu-title">项目</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-about" role="menuitem">
                <a href="/about">
                    <i class="iconfont icon-cup" aria-hidden="true"></i>
                    <span class="menu-title">关于</span>
                </a>
            </div>
        
        

    </nav>
</header>

        <section class="main-section">
            
    <main class="flex-1 px-4 py-14 md:px-5 lg:px-8 lg:py-4 relative min-h-screen">
    

    <article class="content article article-archives article-type-list" itemscope="">
        <header class="article-header">
            
    
        <h1 class="article-title text-lg" itemprop="name">
            RHCE8 考前练习题及答案（下）
        </h1>
    



            <p class="article-meta mb-3 text-xs">
                <span class="article-date">
    <i class="iconfont icon-calendar-check"></i>
	<a href="/2022-08-29-Linux%20%7C%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8B%EF%BC%89.html" class="article-date">
	  <time datetime="2022-08-29T15:07:00.394Z" itemprop="datePublished">8月 29</time>
	</a>
</span>

                
    <span class="article-category">
    <i class="iconfont icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a> , <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/Linux/">Linux</a> , <a class="article-category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a> , <a class="article-category-link" href="/categories/%E8%BF%81%E7%A7%BB%E6%96%87%E7%AB%A0/">迁移文章</a>
  </span>


                
    <span class="article-tags">
    <i class="iconfont icon-tag"></i>
    <a class="article-tag-none-link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="article-tag-none-link" href="/tags/RHCE/" rel="tag">RHCE</a>, <a class="article-tag-none-link" href="/tags/RHEL/" rel="tag">RHEL</a>, <a class="article-tag-none-link" href="/tags/%E8%AE%A4%E8%AF%81%E8%80%83%E8%AF%95/" rel="tag">认证考试</a>
  </span>


                
                
    
        <span class="post-wordcount" itemprop="wordCount">字数统计: 2.9k(字)</span>
    
    
        <span class="post-readcount" itemprop="timeRequired">阅读时长: 13(分)</span>
    


            </p>
        </header>
        <div class="marked-body article-body">
            <blockquote>
<p>🔴 此文章由之前的 Typora 笔记迁移过来，内容可能已经过时。</p>
</blockquote>
<h2 id="（接上常规题）">（接上常规题）</h2>
<h3 id="修改文件内容">修改文件内容</h3>
<p>按照下方所述，创建一个名为 <code>/home/greg/ansible/issue.yml</code> 的 playbook ：</p>
<ol>
<li>
<p>该 <code>playbook</code> 将在所有清单主机上运行；</p>
</li>
<li>
<p>该 <code>playbook</code> 会将 <code>/etc/issue</code> 的内容替换为下方所示的一行文本：</p>
<ul>
<li>在 <code>dev</code> 主机组中的主机上，这行文本显示 为：<code>Development</code>;</li>
<li>在 <code>test</code> 主机组中的主机上，这行文本显示 为：<code>Test</code>;</li>
<li>在 <code>prod</code> 主机组中的主机上，这行文本显示 为：<code>Production</code>.</li>
</ul>
</li>
</ol>
<p>💯 <strong>答案</strong>：</p>
<ol>
<li>创建并编辑剧本：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/issue.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Modify</span> <span class="string">File</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">On</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;Development&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/issue</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot;inventory_hostname in groups.dev&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">On</span> <span class="string">test</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;Test&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/issue</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot;inventory_hostname in groups.test&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">On</span> <span class="string">prod</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;Production&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/issue</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot;inventory_hostname in groups.prod&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>执行剧本并验证：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/issue.yml</span><br><span class="line">[greg@control ansible]$ ansible dev,<span class="built_in">test</span>,prod -a <span class="string">&quot;cat /etc/issue&quot;</span>    <span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>
<h3 id="创建-web-内容目录">创建 web 内容目录</h3>
<p>按照下方所述，创建一个名为 <code>/home/greg/ansible/webcontent.yml</code> 的 playbook ：</p>
<ol>
<li>
<p>该 <code>playbook</code> 在 <code>dev</code> 主机组中的受管节点上运行；</p>
</li>
<li>
<p>创建符合下列要求的目录 <code>/webdev</code>:</p>
<ul>
<li>所有者为 <code>webdev</code> 组；</li>
<li>具有常规权限：<code>owner=read+write+execute</code>, <code>group=read+write+execute</code>, <code>other=read+execute</code>;</li>
<li>具有特殊权限：设置组 <code>ID</code>;</li>
<li>用符号链接将 <code>/var/www/html/webdev</code> 链接到 <code>/webdev</code>;</li>
<li>创建文件 <code>/webdev/index.html</code>, 其中包含如下所示的单行文件： <code>Development</code>;</li>
<li>在 <code>dev</code> 主机组中主机上浏览此目录（例如 <code>http://172.25.250.9/webdev/</code> ）将生成以下输出：</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Development</span><br></pre></td></tr></table></figure>
<p>💯 <strong>答案</strong>：</p>
<p>本题中由于涉及到 web 服务就需要我们进行安装 apache 并配置以及配置防火墙和 selinux 等一系列工作，但是还好我们之前创建过一个 apache 角色，其中的部分操作满足我们此题的需要因此我们也可以直接把 apache 任务部分直接拿过来用。</p>
<ol>
<li>创建并编写剧本：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/webcontent.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">Web</span> <span class="string">Service</span> <span class="string">and</span> <span class="string">Publish</span> <span class="string">Web</span> <span class="string">Content</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">Firewalld</span> <span class="string">Daemon</span> <span class="string">Service</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">firewalld</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Apache</span> <span class="string">Packages</span></span><br><span class="line">      <span class="attr">yum:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">Firewall</span></span><br><span class="line">      <span class="attr">firewalld:</span> </span><br><span class="line">        <span class="attr">service:</span> <span class="string">http</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">enabled</span></span><br><span class="line">        <span class="attr">permanent:</span> <span class="literal">yes</span>    <span class="comment"># 防火墙规则永久生效</span></span><br><span class="line">        <span class="attr">immediate:</span> <span class="literal">yes</span>    <span class="comment"># 防火墙规则立即生效（可能会失败，若防火墙事先未开启）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Group</span> <span class="string">webdav</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">webdav</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Webdav</span> <span class="string">Directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/webdav</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">webdav</span>     <span class="comment"># 需创建 webdav 组</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&#x27;2775&#x27;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">setype:</span> <span class="string">httpd_sys_content_t</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Link</span> <span class="string">to</span> <span class="string">Webdav</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/webdav</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/var/www/html/webdav</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">link</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">index.html</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;Development&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/webdav/index.html</span>    <span class="comment"># 文件不存在会自动创建</span></span><br><span class="line">        <span class="attr">setype:</span> <span class="string">httpd_sys_content_t</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">Auto-start</span> <span class="string">Services</span></span><br><span class="line">      <span class="attr">service:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span>    <span class="comment"># 配置重启让改动生效</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">firewalld</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">httpd</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>执行剧本并验证：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/webcontent.yml</span><br><span class="line">[greg@control ansible]$ curl http://node1/webdav/index.html    <span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>
<h3 id="生成硬件报告">生成硬件报告</h3>
<p>创建一个名为 <code>/home/greg/ansible/hwreport.yml</code> 的 playbook, 它将在所有受管节点上生成含有以下信息的输出文件 <code>/root/hwreport.txt</code>:</p>
<ul>
<li>清单主机名称；</li>
<li>以 <code>MB</code> 表示的总内存大小；</li>
<li><code>BIOS</code> 版本；</li>
<li>磁盘设备 <code>vda</code> 的大小；</li>
<li>磁盘设备 <code>vdb</code> 的大小；</li>
<li>输出文件中的每一行含有一个 <code>key=value</code> 对。</li>
</ul>
<p>您的 playbook 应当：</p>
<ul>
<li>从 <code>http://materials/hwreport.empty</code> 下载文件，并将它保存为 <code>/root/hwreport.txt</code>;</li>
<li>使用正确的值改为 <code>/root/hwreport.txt</code>;</li>
<li>如果硬件项不存在，相关的值应设为 <code>NONE</code>.</li>
</ul>
<p>💯 <strong>答案</strong>：</p>
<p>此题要求在 playbook 任务中实现模板文件下载并替换内容，跟原来自己事先下下来再套用模板的思路不一样。我们可以使用 <code>get_url</code>和<code>replace</code>模块来实现文件下载和文件内容替换，并使用 when 关键字判断硬件是否存在。</p>
<ol>
<li>下载 hwreport.empty 了解其内容：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ wget http://materials/hwreport.empty -P /home/greg/ansible</span><br><span class="line">[greg@control ~]$ <span class="built_in">cat</span> hwreport.empty</span><br></pre></td></tr></table></figure>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hardware report</span></span><br><span class="line"><span class="attr">HOST</span>=inventoryhostname</span><br><span class="line"><span class="attr">MEMORY</span>=memory_in_MB</span><br><span class="line"><span class="attr">BIOS</span>=BIOS_version</span><br><span class="line"><span class="attr">DISK_SIZE_VDA</span>=disk_vda_size</span><br><span class="line"><span class="attr">DISK_SIZE_VDB</span>=disk_vdb_size</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建并编辑剧本：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/hwreport.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">hwreport</span> <span class="string">on</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Download</span> <span class="string">Template</span> <span class="string">File</span></span><br><span class="line">      <span class="attr">get_url:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://materials/hwreport.empty</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Replace</span> <span class="string">Content</span> <span class="string">Of</span> <span class="string">Host</span> <span class="string">Field</span></span><br><span class="line">      <span class="attr">replace:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">&quot;inventoryhostname&quot;</span></span><br><span class="line">        <span class="attr">replace:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_hostname &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Replace</span> <span class="string">Content</span> <span class="string">Of</span> <span class="string">Memory</span> <span class="string">Field</span></span><br><span class="line">      <span class="attr">replace:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">&quot;memory_in_MB&quot;</span></span><br><span class="line">        <span class="attr">replace:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_memtotal_mb|string &#125;&#125;</span>&quot;</span>     <span class="comment"># 解决警告，使用过滤器进行 int 转 string</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Replace</span> <span class="string">Content</span> <span class="string">Of</span> <span class="string">BIOS</span> <span class="string">Field</span></span><br><span class="line">      <span class="attr">replace:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">&quot;BIOS_version&quot;</span></span><br><span class="line">        <span class="attr">replace:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_bios_version &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Replace</span> <span class="string">Content</span> <span class="string">Of</span> <span class="string">DISK_SIZE_VDA</span> <span class="string">Field</span></span><br><span class="line">      <span class="attr">replace:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">&quot;disk_vda_size&quot;</span></span><br><span class="line">        <span class="attr">replace:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_devices.vda.size | default(&#x27;NONE&#x27;) &#125;&#125;</span>&quot;</span>     <span class="comment"># 使用过滤器，未定义时使用默认值</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Replace</span> <span class="string">Content</span> <span class="string">Of</span> <span class="string">DISK_SIZE_VDB</span> <span class="string">Field</span></span><br><span class="line">      <span class="attr">replace:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/root/hwreport.txt</span></span><br><span class="line">        <span class="attr">regexp:</span> <span class="string">&quot;disk_vdb_size&quot;</span></span><br><span class="line">        <span class="attr">replace:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; ansible_devices.vdb.size | default(&#x27;NONE&#x27;) &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>执行 playbook 并验证：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/hwreport.yml</span><br><span class="line">[greg@control ansible]$ ansible all -a <span class="string">&quot;cat /root/hwreport.txt&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建密码库">创建密码库</h3>
<p>按照下方所述，创建一个 Ansible 库来存储用户密码：</p>
<ol>
<li>
<p>库名称为 <code>/home/greg/ansible/locker.yml</code>；</p>
</li>
<li>
<p>库中含有两个变量，名称如下：</p>
<ul>
<li><code>pw_developer</code>, 值为 <code>Imadev</code>;</li>
<li><code>pw_manager</code>, 值为 <code>Imamgr</code>.</li>
</ul>
</li>
<li>
<p>用于加密和解密该库的密码为 <code>whenyouwishuponastar</code>；</p>
</li>
<li>
<p>密码存储在文件 <code>/home/greg/ansible/secret.txt</code> 中。</p>
</li>
</ol>
<p>💯 <strong>答案</strong>：</p>
<p>本题的意思是可以通过加密 playbook 来规避泄密等安全风险，在本题中被加密的 playbook 是 <code>/home/greg/ansible/locker.yml</code>。</p>
<ol>
<li>创建密码文件并将密文写入文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ <span class="built_in">echo</span> <span class="string">&quot;whenyouwishuponastar&quot;</span> &gt; /home/greg/ansible/secret.txt</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>创建 Ansible 库存储用户名和密码信息</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ <span class="built_in">echo</span> <span class="string">&quot;pw_developer: Imadev\npwmanager: Imamgr\n&quot;</span> &gt; /home/greg/ansible/locker.yml</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>（可选）将密码文件的路径写入配置文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vault_password_file</span> = /home/greg/ansible/secret.txt</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>加密该 Ansible 库文件并验证</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-vault encrypt --vault-id=/home/greg/ansible/secret.txt /home/greg/ansible/locker.yml</span><br><span class="line">[greg@control ansible]$ ansible-vault view /home/greg/ansible/locker.yml    <span class="comment"># 解密验证</span></span><br><span class="line">Vault Password: whenyouwishuponastar</span><br></pre></td></tr></table></figure>
<h3 id="创建用户账户">创建用户账户</h3>
<ol>
<li>
<p>从 <code>http://materials/user_list.yml</code> 下载要创建的用户的列表，并将它保存到 <code>/home/greg/ansible</code>；</p>
</li>
<li>
<p>使用在本次考试中使用在其他位置创建的密码库 <code>/home/greg/ansible/locker.yml</code>，创建名为 <code>/home/greg/ansible/users.yml</code> 的 playbook ，从而按以下所述创建用户帐户：</p>
<ol>
<li>
<p>职位描述为 <code>developer</code> 的用户应当：</p>
<ul>
<li>在 <code>dev</code> 和 <code>test</code> 主机组中的受管节点上创建；</li>
<li>从 <code>pw_developer</code> 变量分配密码；</li>
<li>是补充组 <code>devops</code> 的成员。</li>
</ul>
</li>
<li>
<p>职位描述为 <code>manager</code> 的用户应当：</p>
<ul>
<li>在 <code>prod</code> 主机组中的受管节点上创建；</li>
<li>从 <code>pw_manager</code> 变量分配密码；</li>
<li>是补充组 <code>opsmgr</code> 的成员。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>密码采用 <code>SHA512</code> 哈希格式；</p>
</li>
<li>
<p>您的 playbook 应能够在本次考试中使用在其他位置创建的库密码文件 <code>/home/greg/ansible/secret.txt</code> 正常运行。</p>
</li>
</ol>
<p>💯 <strong>答案</strong>：</p>
<ol>
<li>下载用户列表文件并分析</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ wget http://materials/user_list.yml -P /home/greg/ansible &amp;&amp; <span class="built_in">cat</span> /home/greg/ansible/user_list.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">users:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">bob</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">developer</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sally</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">manager</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fred</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">developer</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>编写 playbook</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/users.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">User</span> <span class="string">on</span> <span class="string">dev,test</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev,test</span></span><br><span class="line">  <span class="attr">vars_files:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">/home/greg/ansible/user_list.yml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/home/greg/ansible/locker.yml</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Group</span> <span class="string">devops</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">devops</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">User</span> <span class="string">on</span> <span class="string">dev,test</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pw_developer | password_hash(&#x27;sha512&#x27;) &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">groups:</span> <span class="string">devops</span></span><br><span class="line">        <span class="attr">append:</span> <span class="literal">yes</span>     <span class="comment"># 追加附加组到现有的附加组设置</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; users &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">item.job</span> <span class="string">==</span> <span class="string">&#x27;developer&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">User</span> <span class="string">on</span> <span class="string">prod</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">prod</span></span><br><span class="line">  <span class="attr">vars_files:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">/home/greg/ansible/user_list.yml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/home/greg/ansible/locker.yml</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Group</span> <span class="string">opsmgr</span></span><br><span class="line">      <span class="attr">group:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">opsmgr</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">User</span> <span class="string">on</span> <span class="string">prod</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; pw_manager | password_hash(&#x27;sha512&#x27;) &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">groups:</span> <span class="string">opsmgr</span></span><br><span class="line">        <span class="attr">append:</span> <span class="literal">yes</span>     <span class="comment"># 追加附加组到现有的附加组设置</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; users &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">item.job</span> <span class="string">==</span> <span class="string">&#x27;manager&#x27;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>运行剧本并验证，注意：上面引用了加密的文件因此必须在参数中指定密码文件进行解密才能正常运行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook --vault-password-file=/home/greg/ansible/secret.txt /home/greg/ansible/users.yml</span><br><span class="line">[greg@control ansible]$ ansible dev,<span class="built_in">test</span>,prod -a <span class="string">&quot;tail -2 /etc/passwd&quot;</span>    <span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>
<h3 id="更新-Ansible-库的密钥">更新 Ansible 库的密钥</h3>
<p>按照下方所述，更新现有 Ansible 库的密钥：</p>
<ul>
<li>从 <code>http://materials/salaries.yml</code> 下载 Ansible 库到 <code>/home/greg/ansible</code>;</li>
<li>当前的库密码为 <code>insecure8sure</code>;</li>
<li>新的库密码为 <code>bbs2you9527</code>;</li>
<li>库使用新密码保持加密状态。</li>
</ul>
<p>💯 <strong>答案</strong>：</p>
<ol>
<li>下载所需文件并使用当前库密码进行解密查看</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ wget http://materials/salaries.yml -P /home/greg/ansible</span><br><span class="line">[greg@control ansible]$ ansible-vault view /home/greg/ansible/salaries.yml</span><br><span class="line">Vault Password: insecure8sure</span><br><span class="line">haha    <span class="comment"># 能看到解密后的内容</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>重新加密文件并使用新密码进行解密查看</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-vault rekey /home/greg/ansible/salaries.yml</span><br><span class="line">Vault Password: insecure8sure</span><br><span class="line">New Vault Password: bbs2you9527</span><br><span class="line">Confirm New Vault Password: bbs2you9527</span><br><span class="line">[greg@control ansible]$ ansible-vault view /home/greg/ansible/salaries.yml</span><br><span class="line">Vault Password: bbs2you9527</span><br><span class="line">haha    <span class="comment"># 用新密码能看到解密后的内容</span></span><br></pre></td></tr></table></figure>
<h2 id="附加题">附加题</h2>
<h3 id="安装-RHEL-角色">安装 RHEL 角色</h3>
<p>安装 RHEL ⻆⾊，并使⽤ rhel-system-roles.selinux ⻆⾊，创建剧本<code>/home/greg/ansible/selinux.yml</code>，要求在所有节点运⾏，将 SELINUX 设置为强制模式。</p>
<p>💯 <strong>答案</strong>：</p>
<ol>
<li>安装 RHEL 系统角色包并使用</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ sudo yum install rhel-system-roles -y</span><br></pre></td></tr></table></figure>
<blockquote>
<p>安装的 Ansible 角色一般会放在 <code>/usr/share/ansible/roles/</code> 目录下。在本题，我们需要用到的是 <code>rhel-system-roles.timesync</code> 这个角色。<br />
要使用该角色，还需要在配置文件中引入，编辑配置文件<code>/home/greg/ansible/ansible.cfg</code>，修改以下内容：</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#roles_path = /home/greg/ansible/roles</span></span><br><span class="line"><span class="attr">roles_path</span> = /home/greg/ansible/roles:/usr/share/ansible/roles</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查看本地角色列表：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-galaxy list</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>编写剧本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ <span class="built_in">cp</span> /usr/share/doc/rhel-system-roles/selinux/example-selinux-playbook.yml /home/greg/ansible/selinux.yml</span><br><span class="line">[greg@control ~]$ vim /home/greg/ansible/selinux.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">Enforcing</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">selinux_policy:</span> <span class="string">targeted</span></span><br><span class="line">    <span class="attr">selinux_state:</span> <span class="string">enforcing</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">rhel-system-roles.selinux</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">apply</span> <span class="string">SElinux</span> <span class="string">role</span></span><br><span class="line">      <span class="attr">block:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">include_role:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">rhel-system-roles.selinux</span></span><br><span class="line">      <span class="attr">rescue:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span></span><br><span class="line">          <span class="attr">fail:</span></span><br><span class="line">          <span class="attr">when:</span> <span class="string">not</span> <span class="string">selinux_reboot_required</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">reboot</span></span><br><span class="line">          <span class="attr">shell:</span> <span class="string">reboot</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">changed</span></span><br><span class="line">          <span class="attr">include_role:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">rhel-system-roles.selinux</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>执行剧本并验证</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/selinux.yml</span><br><span class="line">[greg@control ansible]$ ansible all -a <span class="string">&quot;getenforce&quot;</span>    <span class="comment"># 验证</span></span><br></pre></td></tr></table></figure>
<h3 id="创建新的磁盘分区">创建新的磁盘分区</h3>
<p>编写剧本<code>/home/greg/ansible/partition.yml</code>，在 balancers 主机上，划分新的 partition，/dev/vdd，编号1，⼤⼩1500m，格式化成 ext4，挂载到 /newpart ⽬录，如果空间不够，分800m，如果没有vdd，报错。</p>
<p>💯 <strong>答案</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/partition.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> </span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">balancers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">Mount</span> <span class="string">Point</span> <span class="string">Directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">/newpart</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">When</span> <span class="string">/dev/vdd</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">block:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Try</span> <span class="string">To</span> <span class="string">Make</span> <span class="string">A</span> <span class="string">1500m</span> <span class="string">Partition</span></span><br><span class="line">          <span class="attr">parted:</span></span><br><span class="line">            <span class="attr">device:</span> <span class="string">/dev/vdd</span></span><br><span class="line">            <span class="attr">number:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">part_end:</span> <span class="string">1500Mib</span></span><br><span class="line">            <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">rescue:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">Error</span> <span class="string">Messages</span></span><br><span class="line">          <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">Could</span> <span class="string">not</span> <span class="string">create</span> <span class="string">partation</span> <span class="string">of</span> <span class="string">that</span> <span class="string">size</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Try</span> <span class="string">To</span> <span class="string">Make</span> <span class="string">A</span> <span class="string">800m</span> <span class="string">Partition</span></span><br><span class="line">          <span class="attr">parted:</span></span><br><span class="line">            <span class="attr">device:</span> <span class="string">/dev/vdd</span></span><br><span class="line">            <span class="attr">number:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">part_end:</span> <span class="string">800Mib</span></span><br><span class="line">            <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">always:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Make</span> <span class="string">File</span> <span class="string">System</span></span><br><span class="line">          <span class="attr">filesystem:</span></span><br><span class="line">            <span class="attr">device:</span> <span class="string">/dev/vdd1</span></span><br><span class="line">            <span class="attr">fstype:</span> <span class="string">ext4</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Mount</span></span><br><span class="line">          <span class="attr">mount:</span></span><br><span class="line">            <span class="attr">src:</span> <span class="string">/dev/vdd1</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/newpart</span></span><br><span class="line">            <span class="attr">fstype:</span> <span class="string">ext4</span></span><br><span class="line">            <span class="attr">state:</span> <span class="string">mounted</span> </span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot;&#x27;/dev/vdd&#x27; in ansible_facts.devices&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">When</span> <span class="string">/dev/vdd</span> <span class="string">Does</span> <span class="string">not</span> <span class="string">Exist</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">Disk</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exist</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot;&#x27;/dev/vdd&#x27; not in ansible_facts.devices&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用-crontab-模块">使用 crontab 模块</h3>
<p>用户 jack 每三个⽉的每周⽇晚上 22 点 39 分查看⼀次⾃⾝用户登录情况。</p>
<p>💯 <strong>答案</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/crontab.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> </span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">      <span class="attr">cron:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Login</span> <span class="string">Time</span></span><br><span class="line">        <span class="attr">minute:</span> <span class="string">&quot;39&quot;</span>    <span class="comment">#分</span></span><br><span class="line">        <span class="attr">hour:</span> <span class="string">&quot;22&quot;</span>    <span class="comment">#时</span></span><br><span class="line">        <span class="comment"># day: &quot;&quot;     #⽇</span></span><br><span class="line">        <span class="attr">month:</span> <span class="string">&quot;*/3&quot;</span>    <span class="comment">#⽉</span></span><br><span class="line">        <span class="attr">weekday:</span> <span class="string">&quot;0&quot;</span>    <span class="comment">#周</span></span><br><span class="line">        <span class="attr">user:</span> <span class="string">jack</span>    <span class="comment">#指定⽤⼾</span></span><br><span class="line">        <span class="attr">job:</span> <span class="string">&quot;(last &amp;&amp; lastb)|grep jack&quot;</span>    <span class="comment">#执⾏内容</span></span><br></pre></td></tr></table></figure>
<h3 id="创建到期用户账户">创建到期用户账户</h3>
<p>创建用户账户，默认密码是 redhat，使用 sha512 方式加密，账⼾ jack，新增设置密码有效期为 30 天。账⼾ jony，新增设置相应的 ID 1111，⽤⼾有效期到2022-01-20。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/create_user.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> </span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">users:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jack</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jony</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">User</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; &#x27;redhat&#x27; | password_hash(&#x27;sha512&#x27;) &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">loop:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; users &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">Password</span> <span class="string">Expired</span> <span class="string">Day</span> <span class="string">of</span> <span class="string">jack</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">chage</span> <span class="string">-M</span> <span class="number">30</span> <span class="string">jack</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">User</span> <span class="string">Validity</span> <span class="string">Deadline</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">jony</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="string">&#x27;1111&#x27;</span></span><br><span class="line">        <span class="attr">expires:</span> <span class="string">&#x27;1642636800&#x27;</span>    <span class="comment"># 事先执行：date -d 2022-01-20 +%s 获得</span></span><br></pre></td></tr></table></figure>

        </div>
        
<blockquote class="copyright">
    <p><strong>本文链接 : </strong><a class="permalink" href="https://skinyi.github.io/2022-08-29-Linux%20|%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8B%EF%BC%89.html">https://skinyi.github.io/2022-08-29-Linux | RHCE8 考前练习题及答案（下）.html</a></p>
    <p><strong>这篇文章由作者胡编乱造或者由其他文章复制粘贴而来，其中有些内容可能已经过时，请谨慎参考复制文章中的内容。</strong></p>
</blockquote>


    </article>
    
    <section id="comments">
        
    </section>


    

</main>


<aside style="" id="sidebar" class="aside aside-fixture">
    <div class="toc-sidebar">
        <nav id="toc" class="article-toc">
            <h3 class="toc-title">文章目录</h3>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88%E6%8E%A5%E4%B8%8A%E5%B8%B8%E8%A7%84%E9%A2%98%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">（接上常规题）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">1.1.</span> <span class="toc-text">修改文件内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-web-%E5%86%85%E5%AE%B9%E7%9B%AE%E5%BD%95"><span class="toc-number">1.2.</span> <span class="toc-text">创建 web 内容目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E7%A1%AC%E4%BB%B6%E6%8A%A5%E5%91%8A"><span class="toc-number">1.3.</span> <span class="toc-text">生成硬件报告</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93"><span class="toc-number">1.4.</span> <span class="toc-text">创建密码库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7"><span class="toc-number">1.5.</span> <span class="toc-text">创建用户账户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0-Ansible-%E5%BA%93%E7%9A%84%E5%AF%86%E9%92%A5"><span class="toc-number">1.6.</span> <span class="toc-text">更新 Ansible 库的密钥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%8A%A0%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">附加题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-RHEL-%E8%A7%92%E8%89%B2"><span class="toc-number">2.1.</span> <span class="toc-text">安装 RHEL 角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA"><span class="toc-number">2.2.</span> <span class="toc-text">创建新的磁盘分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-crontab-%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.</span> <span class="toc-text">使用 crontab 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%B0%E6%9C%9F%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7"><span class="toc-number">2.4.</span> <span class="toc-text">创建到期用户账户</span></a></li></ol></li></ol>
        </nav>
    </div>
</aside>





        </section>
        <footer class="hidden lg:block fixed bottom-0 left-0 sm:w-1/12 bg-gray-100 z-40">
    
    
        <p class="footer-custom">❤ Powered by <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> with <a href="https://github.com/fengkx/hexo-theme-purer" target="_blank" rel="noopener noreferrer">Purer theme</a>.</p>
    
</footer>

        <div id="mask" class="hidden mask fixed inset-0 bg-gray-900 opacity-75 z-40"></div>
        <div id="search-view-container" class="hidden shadow-xl"></div>
        
<script src="/js/dom-event.min.js"></script>



<script src="/js/local-search.min.js"></script>



    <script src="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
<script src="/js/light-gallery.min.js"></script>






    </body>
</html>
