<!DOCTYPE html>
<html  lang="zh-CN,en,default" >
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <title>RHCE8 è€ƒå‰ç»ƒä¹ é¢˜åŠç­”æ¡ˆï¼ˆä¸Šï¼‰ | Avery Ma çš„ä¸ªäººç½‘ç«™</title>
    <meta name="description" content="ğŸ”´ æ­¤æ–‡ç« ç”±ä¹‹å‰çš„ Typora ç¬”è®°è¿ç§»è¿‡æ¥ï¼Œå†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ã€‚  å¸¸è§„é¢˜ç›® å®‰è£…å’Œé…ç½® Ansible æŒ‰ç…§ä¸‹æ–¹æ‰€è¿°ï¼Œåœ¨æ§åˆ¶èŠ‚ç‚¹ control ä¸Šå®‰è£…å’Œé…ç½® Ansibleï¼š  å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚ åˆ›å»ºåä¸º &#x2F;home&#x2F;greg&#x2F;ansible&#x2F;inventory çš„é™æ€æ¸…å•æ–‡ä»¶ï¼Œä»¥æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š  node1 æ˜¯ dev ä¸»æœºç»„çš„æˆå‘˜ï¼› node2 æ˜¯ test ä¸»æœºç»„çš„æˆå‘˜ï¼› nod">
<meta property="og:type" content="article">
<meta property="og:title" content="RHCE8 è€ƒå‰ç»ƒä¹ é¢˜åŠç­”æ¡ˆï¼ˆä¸Šï¼‰">
<meta property="og:url" content="https://skinyi.github.io/2022-08-29-Linux%20|%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8A%EF%BC%89.html">
<meta property="og:site_name" content="Avery Ma çš„ä¸ªäººç½‘ç«™">
<meta property="og:description" content="ğŸ”´ æ­¤æ–‡ç« ç”±ä¹‹å‰çš„ Typora ç¬”è®°è¿ç§»è¿‡æ¥ï¼Œå†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ã€‚  å¸¸è§„é¢˜ç›® å®‰è£…å’Œé…ç½® Ansible æŒ‰ç…§ä¸‹æ–¹æ‰€è¿°ï¼Œåœ¨æ§åˆ¶èŠ‚ç‚¹ control ä¸Šå®‰è£…å’Œé…ç½® Ansibleï¼š  å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚ åˆ›å»ºåä¸º &#x2F;home&#x2F;greg&#x2F;ansible&#x2F;inventory çš„é™æ€æ¸…å•æ–‡ä»¶ï¼Œä»¥æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š  node1 æ˜¯ dev ä¸»æœºç»„çš„æˆå‘˜ï¼› node2 æ˜¯ test ä¸»æœºç»„çš„æˆå‘˜ï¼› nod">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-29T15:04:23.290Z">
<meta property="article:modified_time" content="2022-08-30T03:46:48.068Z">
<meta property="article:author" content="skinyi">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="RHEL">
<meta property="article:tag" content="RHCE">
<meta property="article:tag" content="è®¤è¯è€ƒè¯•">
<meta name="twitter:card" content="summary">

    
    <link rel="icon" href="images/favicon.png" type="image/x-icon">

    
<link rel="stylesheet" href="/css/common.min.css">



    
    
    
    
        <link href="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/css/lightgallery.min.css" rel="stylesheet">
    
    
    
<link rel="stylesheet" href="/css/iconfont.min.css">

    
<meta name="generator" content="Hexo 6.2.0"></head>

    <body>
        <header class="header header-fixture">
    <div class="profile-search-wrap flex sm:block">
        
        
        <div class="profile sm:text-center md:px-1 lg:px-3 sm:pb-4 sm:pt-6">
            <a id="avatar" role="link" href="https://github.com/skinyi" class="inline-block lg:w-16 lg:h-16 w-8 h-8 m-2" target="_blank" rel="noopener" rel="noreferrer" >
                <img src="/images/avatar.jpg" class="rounded-full" alt="avatar">
            </a>
            <h2 id="name" class="hidden lg:block">Avery Ma</h2>
            <h3 id="title" class="hidden xl:block">IT ä»ä¸šè€…</h3>
            
            <small id="location" class="hidden lg:block">
                <i class="iconfont icon-map-icon"></i>
                å®å¤, ä¸­å›½
            </small>
            
        </div>
        
        
<div class="search flex-1 flex lg:inline-block sm:hidden lg:px-4 lg:mt-2 lg:w-full">
    <form id="search-form" class="my-auto flex-1 lg:border lg:border-solid lg:border-gray-200">
        <div class="input-group table bg-gray-100 lg:bg-white w-full">
            <input id="search-input" type="text" placeholder="æœç´¢" class="inline-block w-full bg-gray-100 lg:bg-white">
            <span class="table-cell">
                <button name="search tigger button" disabled>
                    <i class="iconfont icon-search m-2"></i>
                </button>
            </span>
        </div>
    </form>
        
<div id="content-json" data-placeholder="æœç´¢" class="invisible hidden">/content.json</div>
<script id="search-teamplate" type="text/html" data-path="/content.json">
    <div>
        <div class="search-header bg-gray-400">
            <input id="actual-search-input" model="keyword" ref="input" class="inline-block w-full h-10 px-2 py-1" placeholder="æœç´¢" type="text">
        </div>
        <div class="search-result bg-gray-200">
            {{#each searchPosts}}
            <a href="/{{ path }}" class="result-item block px-2 pb-3 mb-1 pt-1 hover:bg-indigo-100">
                <i class="iconfont icon-file"></i>
                <h1 class="result-title inline font-medium text-lg">{{ title }}</h1>
                <p class="result-content text-gray-600 text-sm">{{{ text }}}</p>
            </a>
            {{/each}}
        </div>
    </div>
</script>

</div>


        <button name="menu toogle button" id="menu-toggle-btn" class="block sm:hidden p-3" role="button" aria-expanded="false">
            <i class="iconfont icon-hamburger"></i>
        </button>
    </div>
    <nav id="menu-nav" class="hidden sm:flex flex-col">
        
        
            <div class="menu-item menu-home" role="menuitem">
                <a href="/.">
                    <i class="iconfont icon-home" aria-hidden="true"></i>
                    <span class="menu-title">é¦–é¡µ</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-archives" role="menuitem">
                <a href="/archives">
                    <i class="iconfont icon-archive" aria-hidden="true"></i>
                    <span class="menu-title">å½’æ¡£</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-categories" role="menuitem">
                <a href="/categories">
                    <i class="iconfont icon-folder" aria-hidden="true"></i>
                    <span class="menu-title">åˆ†ç±»</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-tags" role="menuitem">
                <a href="/tags">
                    <i class="iconfont icon-tag" aria-hidden="true"></i>
                    <span class="menu-title">æ ‡ç­¾</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-repository" role="menuitem">
                <a href="/repository">
                    <i class="iconfont icon-project" aria-hidden="true"></i>
                    <span class="menu-title">é¡¹ç›®</span>
                </a>
            </div>
        
        
            <div class="menu-item menu-about" role="menuitem">
                <a href="/about">
                    <i class="iconfont icon-cup" aria-hidden="true"></i>
                    <span class="menu-title">å…³äº</span>
                </a>
            </div>
        
        

    </nav>
</header>

        <section class="main-section">
            
    <main class="flex-1 px-4 py-14 md:px-5 lg:px-8 lg:py-4 relative min-h-screen">
    

    <article class="content article article-archives article-type-list" itemscope="">
        <header class="article-header">
            
    
        <h1 class="article-title text-lg" itemprop="name">
            RHCE8 è€ƒå‰ç»ƒä¹ é¢˜åŠç­”æ¡ˆï¼ˆä¸Šï¼‰
        </h1>
    



            <p class="article-meta mb-3 text-xs">
                <span class="article-date">
    <i class="iconfont icon-calendar-check"></i>
	<a href="/2022-08-29-Linux%20%7C%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8A%EF%BC%89.html" class="article-date">
	  <time datetime="2022-08-29T15:04:23.290Z" itemprop="datePublished">8æœˆ 29</time>
	</a>
</span>

                
    <span class="article-category">
    <i class="iconfont icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a> , <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0/Linux/">Linux</a> , <a class="article-category-link" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">æ—¥å¸¸è®°å½•</a> , <a class="article-category-link" href="/categories/%E8%BF%81%E7%A7%BB%E6%96%87%E7%AB%A0/">è¿ç§»æ–‡ç« </a>
  </span>


                
    <span class="article-tags">
    <i class="iconfont icon-tag"></i>
    <a class="article-tag-none-link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="article-tag-none-link" href="/tags/RHCE/" rel="tag">RHCE</a>, <a class="article-tag-none-link" href="/tags/RHEL/" rel="tag">RHEL</a>, <a class="article-tag-none-link" href="/tags/%E8%AE%A4%E8%AF%81%E8%80%83%E8%AF%95/" rel="tag">è®¤è¯è€ƒè¯•</a>
  </span>


                
                
    
        <span class="post-wordcount" itemprop="wordCount">å­—æ•°ç»Ÿè®¡: 3.4k(å­—)</span>
    
    
        <span class="post-readcount" itemprop="timeRequired">é˜…è¯»æ—¶é•¿: 15(åˆ†)</span>
    


            </p>
        </header>
        <div class="marked-body article-body">
            <blockquote>
<p>ğŸ”´ æ­¤æ–‡ç« ç”±ä¹‹å‰çš„ Typora ç¬”è®°è¿ç§»è¿‡æ¥ï¼Œå†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ã€‚</p>
</blockquote>
<h2 id="å¸¸è§„é¢˜ç›®">å¸¸è§„é¢˜ç›®</h2>
<h3 id="å®‰è£…å’Œé…ç½®-Ansible">å®‰è£…å’Œé…ç½® Ansible</h3>
<p>æŒ‰ç…§ä¸‹æ–¹æ‰€è¿°ï¼Œåœ¨æ§åˆ¶èŠ‚ç‚¹ control ä¸Šå®‰è£…å’Œé…ç½® Ansibleï¼š</p>
<ol>
<li>å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚</li>
<li>åˆ›å»ºåä¸º <code>/home/greg/ansible/inventory</code> çš„é™æ€æ¸…å•æ–‡ä»¶ï¼Œä»¥æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
<ul>
<li><code>node1</code> æ˜¯ <code>dev</code> ä¸»æœºç»„çš„æˆå‘˜ï¼›</li>
<li><code>node2</code> æ˜¯ <code>test</code> ä¸»æœºç»„çš„æˆå‘˜ï¼›</li>
<li><code>node3</code> å’Œ <code>node4</code> æ˜¯ <code>prod</code> ä¸»æœºç»„çš„æˆå‘˜ï¼›</li>
<li><code>node5</code> æ˜¯ <code>balancers</code> ä¸»æœºç»„çš„æˆå‘˜ï¼›</li>
<li><code>prod</code> ç»„æ˜¯ <code>webservers</code> ä¸»æœºç»„çš„æˆå‘˜ï¼›</li>
</ul>
</li>
<li>åˆ›å»ºåä¸º <code>/home/greg/ansible/ansible.cfg</code> çš„é…ç½®æ–‡ä»¶ï¼Œä»¥æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</li>
<li>ä¸»æœºæ¸…å•æ–‡ä»¶ä¸º <code>/home/greg/ansible/inventory</code>;</li>
<li><code>playbook</code> ä¸­ä½¿ç”¨çš„è§’è‰²çš„ä½ç½®åŒ…æ‹¬ <code>/home/greg/ansible/roles</code>ã€‚</li>
</ol>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å®‰è£…æ‰€éœ€è½¯ä»¶åŒ…ï¼Œå³å®‰è£… Ansible</span></span><br><span class="line">[greg@control ~]$ sudo yum install ansible -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åˆ›å»ºå¹¶ç¼–è¾‘æ¸…å•æ–‡ä»¶</span></span><br><span class="line">[greg@control ~]$ vim /home/greg/ansible/inventory</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘æ¸…å•æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dev]</span></span><br><span class="line">node1</span><br><span class="line"></span><br><span class="line"><span class="section">[test]</span></span><br><span class="line">node2</span><br><span class="line"></span><br><span class="line"><span class="section">[prod]</span></span><br><span class="line">node3</span><br><span class="line">node4</span><br><span class="line"></span><br><span class="line"><span class="section">[balancers]</span></span><br><span class="line">node5</span><br><span class="line"></span><br><span class="line"><span class="section">[webservers:children]</span></span><br><span class="line">prod</span><br></pre></td></tr></table></figure>
<p>å°† Ansible ç³»ç»Ÿé…ç½®æ–‡ä»¶æ‹·è´åˆ°ç”¨æˆ· Ansible å·¥ä½œç›®å½•ä¸€ä»½ï¼Œå¹¶ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼Œç”¨æˆ·åœ¨è¯¥å·¥ä½œç›®å½•ä¸‹æ‰§è¡Œ Ansible ç›¸å…³å‘½ä»¤æ—¶ä¼šä¼˜å…ˆä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ <span class="built_in">cp</span> /etc/ansible/ansible.cfg /home/greg/ansible/</span><br><span class="line">[greg@control ~]$ <span class="built_in">mkdir</span> /home/greg/ansible/roles</span><br><span class="line">[greg@control ~]$ vim /home/greg/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#inventory = /etc/ansible/hosts</span></span><br><span class="line"><span class="attr">inventory</span> = /home/greg/ansible/inventory</span><br><span class="line"></span><br><span class="line"><span class="comment">#roles_path = /etc/ansible/roles</span></span><br><span class="line"><span class="attr">roles_path</span> = /home/greg/ansible/roles</span><br><span class="line"></span><br><span class="line"><span class="comment">#reomote_user = root</span></span><br><span class="line"><span class="attr">remote_user</span> = greg</span><br><span class="line"></span><br><span class="line"><span class="comment">#host_key_checking = False</span></span><br><span class="line"><span class="attr">host_key_checking</span> = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="section">[privilege_escalation]</span></span><br><span class="line"><span class="attr">become</span>=<span class="literal">True</span></span><br><span class="line"><span class="attr">become_method</span>=sudo</span><br><span class="line"><span class="attr">become_user</span>=root</span><br><span class="line"><span class="attr">become_ask_pass</span>=<span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible all -m ping    <span class="comment"># ä¸æŒ‡å®šæ¨¡å—æ—¶é»˜è®¤ä½¿ç”¨ command æ¨¡å—</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå’Œè¿è¡Œ-Ansible-ä¸´æ—¶å‘½ä»¤">åˆ›å»ºå’Œè¿è¡Œ Ansible ä¸´æ—¶å‘½ä»¤</h3>
<p>ä½œä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼Œæ‚¨éœ€è¦åœ¨å—ç®¡èŠ‚ç‚¹ä¸Šå®‰è£…è½¯ä»¶ã€‚</p>
<p>è¯·æŒ‰ç…§æ­£æ–‡æ‰€è¿°ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>/home/greg/ansible/adhoc.sh</code> çš„ shell è„šæœ¬ï¼Œè¯¥è„šæœ¬å°†ä½¿ç”¨ Ansible ä¸´æ—¶å‘½ä»¤åœ¨å„ä¸ªå—ç®¡èŠ‚ç‚¹ä¸Šå®‰è£… yum å­˜å‚¨åº“ï¼š</p>
<p>å­˜å‚¨åº“ 1ï¼š</p>
<ul>
<li>å­˜å‚¨åº“çš„åç§°ä¸º <code>EX294_BASE</code>;</li>
<li>æè¿°ä¸º <code>EX294 base software</code>;</li>
<li>åŸºç¡€ URL ä¸º <code>http://content/rhel8.0/x86_64/dvd/BaseOS</code>;</li>
<li>GPG ç­¾åæ£€æŸ¥ä¸ºå¯ç”¨çŠ¶æ€;</li>
<li>GPG å¯†é’¥ URL ä¸º <code>http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release</code>;</li>
<li>å­˜å‚¨åº“ä¸ºå¯ç”¨çŠ¶æ€ã€‚</li>
</ul>
<p>å­˜å‚¨åº“ 2ï¼š</p>
<ul>
<li>å­˜å‚¨åº“çš„åç§°ä¸º <code>EX294_STREAM</code>;</li>
<li>æè¿°ä¸º <code>EX294 stream software</code>;</li>
<li>åŸºç¡€ URL ä¸º <code>http://content/rhel8.0/x86_64/dvd/AppStream</code>;</li>
<li>GPG ç­¾åæ£€æŸ¥ä¸ºå¯ç”¨çŠ¶æ€;</li>
<li>GPG å¯†é’¥ URL ä¸º <code>http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release</code>;</li>
<li>å­˜å‚¨åº“ä¸ºå¯ç”¨çŠ¶æ€ã€‚</li>
</ul>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/adhoc.sh</span><br><span class="line">ansible all -m yum_repository -a <span class="string">&quot;name=EX294_BASE description=&#x27;EX294 base software&#x27; baseurl=http://content/rhel8.0/x86_64/dvd/BaseOS gpgcheck=yes gpgkey=http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release enabled=yes&quot;</span></span><br><span class="line">ansible all -m yum_repository -a <span class="string">&quot;name=EX294_STREAM description=&#x27;EX294 stream software&#x27; baseurl=http://content/rhel8.0/x86_64/dvd/AppStream gpgcheck=yes gpgkey=http://content/rhel8.0/x86_64/dvd/RPM-GPG-KEY-redhat-release enabled=yes&quot;</span></span><br><span class="line">[greg@control ~]$ <span class="built_in">chmod</span> u+x /home/greg/ansible/adhoc.sh</span><br><span class="line">[greg@control ~]$ /home/greg/ansible/adhoc.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯</span></span><br><span class="line">[greg@control ~]$ ansible all -a <span class="string">&quot;yum repolist&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…è½¯ä»¶åŒ…">å®‰è£…è½¯ä»¶åŒ…</h3>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>/home/greg/ansible/packages.yml</code> çš„ <code>playbook</code>:</p>
<ul>
<li>å°† <code>php</code> å’Œ <code>mariadb</code> è½¯ä»¶åŒ…å®‰è£…åˆ° <code>dev</code>ã€<code>test</code> å’Œ <code>prod</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šï¼›</li>
<li>å°† <code>RPM Development Tools</code> è½¯ä»¶åŒ…ç»„å®‰è£…åˆ° <code>dev</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šï¼›</li>
<li>å°† <code>dev</code> ä¸»æœºç»„ä¸­ä¸»æœºä¸Šçš„æ‰€æœ‰è½¯ä»¶åŒ…æ›´æ–°ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚</li>
</ul>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œåˆ›å»º playbook æ–‡ä»¶ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/packages.yml</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ç¼–è¾‘è¯¥ playbook æ–‡ä»¶çš„å†…å®¹ï¼š</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># è¦æ±‚ä¸€</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Installation</span> <span class="string">on</span> <span class="string">dev,test,prod</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev,test,prod</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">php</span> <span class="string">and</span> <span class="string">mariadb</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">loop:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">mariadb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦æ±‚äºŒ</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Installation</span> <span class="string">on</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">@RPM</span> <span class="string">Development</span> <span class="string">Tools</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;@RPM Development Tools&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦æ±‚ä¸‰</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Updates-check</span> <span class="string">on</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Check</span> <span class="string">Updates</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;*&quot;</span>    <span class="comment"># æ³¨æ„å¼•å·ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">latest</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æ‰§è¡Œ playbookï¼Œä¸€èˆ¬åªè¦ç»“æœä¸æ˜¯çº¢è‰²å°±æ²¡é—®é¢˜ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/packages.yml</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>éªŒè¯ï¼Œè‹¥èƒ½æŸ¥åˆ°å·²å®‰è£… php åˆ™è¯´æ˜å‰§æœ¬æ‰§è¡Œçš„æ²¡é—®é¢˜ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible dev -a <span class="string">&quot;rpm -q php&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-RHEL-ç³»ç»Ÿè§’è‰²">ä½¿ç”¨ RHEL ç³»ç»Ÿè§’è‰²</h3>
<p>å®‰è£… RHEL ç³»ç»Ÿè§’è‰²è½¯ä»¶åŒ…ï¼Œå¹¶åˆ›å»ºç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„ playbook <code>/home/greg/ansible/timesync.yml</code>ï¼š</p>
<ul>
<li>åœ¨æ‰€æœ‰å—ç®¡èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>ä½¿ç”¨ <code>timesync</code> è§’è‰²</li>
<li>é…ç½®è¯¥è§’è‰²ï¼Œä»¥ä½¿ç”¨å½“å‰æœ‰æ•ˆçš„ <code>NTP</code> æä¾›å•†</li>
<li>é…ç½®è¯¥è§’è‰²ï¼Œä»¥ä½¿ç”¨æ—¶é—´æœåŠ¡å™¨ <code>172.25.254.254</code></li>
<li>é…ç½®è¯¥è§’è‰²ï¼Œä»¥å¯ç”¨ <code>iburst</code> å‚æ•°</li>
</ul>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>å®‰è£… RHEL ç³»ç»Ÿè§’è‰²åŒ…å¹¶ä½¿ç”¨ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ sudo yum install rhel-system-roles -y</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®‰è£…çš„ Ansible è§’è‰²ä¸€èˆ¬ä¼šæ”¾åœ¨ <code>/usr/share/ansible/roles/</code> ç›®å½•ä¸‹ã€‚åœ¨æœ¬é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ˜¯ <code>rhel-system-roles.timesync</code> è¿™ä¸ªè§’è‰²ã€‚<br />
è¦ä½¿ç”¨è¯¥è§’è‰²ï¼Œè¿˜éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶<code>/home/greg/ansible/ansible.cfg</code>ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#roles_path = /home/greg/ansible/roles</span></span><br><span class="line"><span class="attr">roles_path</span> = /home/greg/ansible/roles:/usr/share/ansible/roles</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æŸ¥çœ‹æœ¬åœ°è§’è‰²åˆ—è¡¨ï¼š</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-galaxy list</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åˆ›å»º playbookï¼Œå¹¶å‚è€ƒæ–‡æ¡£<code>/usr/share/ansible/roles/rhel-system-roles.timesync/README.md</code>ä¸­çš„ä¾‹å­ï¼Œç¼–è¾‘è¯¥ playbookï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/timesync.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configre</span> <span class="string">NTP</span> <span class="string">server</span> <span class="string">on</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">vars:</span> </span><br><span class="line">    <span class="attr">timesync_ntp_servers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostname:</span> <span class="number">172.25</span><span class="number">.254</span><span class="number">.254</span></span><br><span class="line">        <span class="attr">iburst:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">timesync</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æ‰§è¡Œ playbookï¼Œæ­¤è¿‡ç¨‹å¯èƒ½ä¼šæœ‰ä¸€äº›çº¢é¢œè‰²çš„æŠ¥é”™ï¼Œä½†æ˜¯åªè¦åé¢çš„éªŒè¯æ²¡é—®é¢˜å°±å¯ä»¥ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/timesync.yml</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible all -a <span class="string">&quot;chronyc sources&quot;</span></span><br><span class="line">[greg@control ansible]$ ansible all -a <span class="string">&quot;timedatectl&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-Ansible-Galaxy-å®‰è£…è§’è‰²">ä½¿ç”¨ Ansible Galaxy å®‰è£…è§’è‰²</h3>
<p>ä½¿ç”¨ <code>Ansible Galaxy</code> å’Œè¦æ±‚æ–‡ä»¶ <code>/home/greg/ansible/roles/requirements.yml</code>ã€‚ä»ä»¥ä¸‹ URL ä¸‹è½½è§’è‰²å¹¶å®‰è£…åˆ° <code>/home/greg/ansible/roles</code>ï¼š</p>
<ul>
<li><code>http://materials/haproxy.tar</code> æ­¤è§’è‰²çš„åç§°åº”å½“ä¸º <code>balancer</code>;</li>
<li><code>http://materials/phpinfo.tar</code> æ­¤è§’è‰²çš„åç§°åº”å½“ä¸º <code>phpinfo</code>.</li>
</ul>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>æ ¹æ®é¢˜ç›®è¦æ±‚åˆ›å»º requirements.yml æ–‡ä»¶å¹¶ç¼–è¾‘ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/roles/requirements.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">balancer</span></span><br><span class="line">  <span class="attr">src:</span> <span class="string">http://materails/haproxy.tar</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">phpinfo</span></span><br><span class="line">  <span class="attr">src:</span> <span class="string">http://materials/phpinfo.tar</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä½¿ç”¨è§’è‰²æ–‡ä»¶å®‰è£…è§’è‰²ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-galaxy install -r /home/greg/ansible/roles/requirements.yml -p /home/greg/ansible/roles</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‚æ•°æ„ä¹‰ï¼š</p>
<p>-r ROLE_FILE, --role-file=ROLE_FILEÂ Â Â Â æŒ‡å®šä»æ–‡ä»¶ä¸­å¯¼å…¥è§’è‰²<br />
-p ROLES_PATH, --roles-path=ROLES_PATHÂ Â Â Â æŒ‡å®šå®‰è£…è§’è‰²çš„ä½ç½®ï¼Œé»˜è®¤ä¸º ansible.cfg ä¸­é…ç½®çš„</p>
</blockquote>
<ol start="3">
<li>éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-galaxy list</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå’Œä½¿ç”¨è§’è‰²">åˆ›å»ºå’Œä½¿ç”¨è§’è‰²</h3>
<p>æ ¹æ®ä¸‹åˆ—è¦æ±‚ï¼Œåœ¨ <code>/home/greg/ansible/roles</code> ä¸­åˆ›å»ºåä¸º <code>apache</code> çš„è§’è‰²ï¼š</p>
<ul>
<li><code>httpd</code> è½¯ä»¶åŒ…å·²å®‰è£…ï¼Œè®¾ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯ç”¨å¹¶å¯åŠ¨</li>
<li>é˜²ç«å¢™å·²å¯ç”¨å¹¶æ­£åœ¨è¿è¡Œï¼Œå¹¶ä½¿ç”¨å…è®¸è®¿é—® <code>Web</code> æœåŠ¡å™¨çš„è§„åˆ™</li>
<li>æ¨¡æ¿æ–‡ä»¶ <code>index.html.j2</code> å·²å­˜åœ¨ï¼Œç”¨äºåˆ›å»ºå…·æœ‰ä»¥ä¸‹è¾“å‡ºçš„æ–‡ä»¶ <code>/var/www/html/index.html</code>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to HOSTNAME on IPADDRESS</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>HOSTNAME</code> æ˜¯å—ç®¡èŠ‚ç‚¹çš„å®Œå…¨é™å®šåŸŸåï¼Œ<code>IPADDRESS</code> åˆ™æ˜¯å—ç®¡èŠ‚ç‚¹çš„ <code>IP</code> åœ°å€ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªä½¿ç”¨æ­¤è§’è‰²çš„ playbook <code>/home/greg/ansible/newrole.yml</code>ï¼Œè¯¥ playbook åœ¨ <code>webservers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šè¿è¡Œã€‚</p>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºè§’è‰²</li>
</ol>
<p>åˆ‡æ¢åˆ°è§’è‰²ç›®å½•å¹¶åˆ›å»º apache è§’è‰²çš„éª¨æ¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ <span class="built_in">cd</span> /home/greg/ansible/roles</span><br><span class="line">[greg@control roles]$ ansible-galaxy init apache</span><br><span class="line">[greg@control roles]$ tree /home/greg/ansible/apache/    <span class="comment"># æŸ¥çœ‹ apache è§’è‰²çš„ç›®å½•ç»“æ„</span></span><br></pre></td></tr></table></figure>
<p>è§’è‰²ç›®å½•ä¸­ä¸åŒçš„æ–‡ä»¶å¤¹çš„ä½œç”¨æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li>defaults: è§’è‰²çš„é»˜è®¤å˜é‡ï¼›</li>
<li>files: åŒ…å«å¯ä»¥ç»ç”±æ­¤è§’è‰²éƒ¨ç½²çš„æ–‡ä»¶ï¼›</li>
<li>xxxxxxxxxxÂ # è§ ServerA é…ç½® yum/dnf ä»“åº“éƒ¨åˆ† æˆ–ï¼š[root@node2 ~]# scp root@server1:/etc/yum.repos.d/Default.repo /etc/yum.repos.d/bash</li>
<li>meta: è§’è‰²å®šä¹‰çš„ä¸€äº›å…ƒæ•°æ®ï¼›</li>
<li>tasks: åŒ…å«è§’è‰²è¦æ‰§è¡Œçš„ä¸»è¦ä»»åŠ¡çš„åˆ—è¡¨ï¼›</li>
<li>templates: åŒ…å«å¯ä»¥ç»ç”±æ­¤è§’è‰²éƒ¨ç½²çš„æ¨¡æ¿ï¼›</li>
<li>tests: è§’è‰²çš„æµ‹è¯•æ–‡ä»¶ï¼›</li>
<li>vars: è§’è‰²çš„å…¶ä»–å˜é‡ã€‚</li>
</ul>
<p>æœ¬é¢˜æˆ‘ä»¬ä¸»è¦ç”¨åˆ° tasks å’Œ templates ä¸¤ä¸ªç›®å½•ä¸­çš„å†…å®¹ï¼Œå…¶ä¸­ tasks ç”¨æ¥å­˜æ”¾è¯¥è§’è‰²æ‰€è¦æ‰§è¡Œçš„ä¸€äº›ä»»åŠ¡ï¼Œtemplates ç”¨æ¥å­˜æ”¾é¢˜ç›®ä¸­æ¶‰åŠçš„æ¨¡æ¿æ–‡ä»¶ã€‚</p>
<ol start="2">
<li>ç¼–è¾‘è§’è‰²çš„ playbook åŠåˆ›å»ºæ¨¡æ¿æ–‡ä»¶</li>
</ol>
<p>ç¼–è¾‘ tasks/main.yml æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control roles]$ vim /home/greg/ansible/roles/apache/tasks/main.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 0. å¼€å¯é˜²ç«å¢™ - æ³¨æ„çœ‹å¼€å§‹çš„è¯´æ˜ï¼šé˜²ç«å¢™é»˜è®¤å…³é—­ï¼Œå¦åˆ™ç¬¬äºŒæ­¥ä¼šå¤±è´¥</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Start</span> <span class="string">Firewalld</span> <span class="string">Service</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">firewalld</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®‰è£… httpd åŒ…</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Apache</span> <span class="string">Packages</span></span><br><span class="line">  <span class="attr">yum:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. é…ç½®é˜²ç«å¢™</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">Firewall</span></span><br><span class="line">  <span class="attr">firewalld:</span> </span><br><span class="line">    <span class="attr">service:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">enabled</span></span><br><span class="line">    <span class="attr">permanent:</span> <span class="literal">yes</span>    <span class="comment"># é˜²ç«å¢™è§„åˆ™æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="attr">immediate:</span> <span class="literal">yes</span>    <span class="comment"># é˜²ç«å¢™è§„åˆ™ç«‹å³ç”Ÿæ•ˆï¼ˆå¯èƒ½ä¼šå¤±è´¥ï¼Œè‹¥é˜²ç«å¢™äº‹å…ˆæœªå¼€å¯ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ ¹æ®æ¨¡æ¿ç”Ÿæˆç½‘é¡µæ–‡ä»¶</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">Web</span> <span class="string">Page</span> <span class="string">from</span> <span class="string">template</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">index.html.j2</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/var/www/html/index.html</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">apache</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">apache</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">&#x27;0644&#x27;</span></span><br><span class="line">    <span class="attr">setype:</span> <span class="string">httpd_sys_content_t</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. é…ç½®æœåŠ¡è‡ªå¯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Enable</span> <span class="string">Auto-start</span> <span class="string">Services</span></span><br><span class="line">  <span class="attr">service:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span>    <span class="comment"># é…ç½®é‡å¯è®©æ”¹åŠ¨ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">loop:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">firewalld</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">httpd</span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘ templates/index.html.j2 æ¨¡æ¿æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control roles]$ vim /home/greg/ansbible/roles/apache/templates/index.html.j2</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to &#123;&#123; ansible_hostname &#125;&#125; on &#123;&#123; ansible_default_ipv4.address &#125;&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>åˆ›å»º playbook ä½¿ç”¨ apache è§’è‰²ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control roles]$ vim /home/greg/ansible/newrole.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">Apache</span> <span class="string">Service</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">roles:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">apache</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æ‰§è¡Œ playbook å¹¶éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/newrole.yml</span><br><span class="line">[greg@control ansible]$ curl http://node3Â Â Â Â <span class="comment"># éªŒè¯ node3</span></span><br><span class="line">[greg@control ansible]$ curl http://node4Â Â Â Â <span class="comment"># éªŒè¯ node4</span></span><br></pre></td></tr></table></figure>
<h3 id="ä»-Ansible-Galaxy-ä½¿ç”¨è§’è‰²">ä» Ansible Galaxy ä½¿ç”¨è§’è‰²</h3>
<p>æ ¹æ®ä¸‹åˆ—è¦æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>/home/greg/ansible/roles.yml</code> çš„ playbook ï¼š</p>
<ol>
<li>
<p>playbook ä¸­åŒ…å«ä¸€ä¸ª playï¼Œ è¯¥ play åœ¨ <code>balancers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šè¿è¡Œå¹¶å°†ä½¿ç”¨ <code>balancer</code> è§’è‰²ã€‚</p>
<ul>
<li>
<p>æ­¤è§’è‰²é…ç½®ä¸€é¡¹æœåŠ¡ï¼Œä»¥åœ¨ <code>webservers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¹‹é—´å¹³è¡¡ <code>Web</code> æœåŠ¡å™¨è¯·æ±‚çš„è´Ÿè½½ã€‚</p>
</li>
<li>
<p>æµè§ˆåˆ° <code>balancers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºï¼ˆä¾‹å¦‚ <code>http://172.25.250.13</code> ï¼‰å°†ç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to serverb.lab.example.com on 172.25.250.11</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é‡æ–°åŠ è½½æµè§ˆå™¨å°†ä»å¦ä¸€ Web æœåŠ¡å™¨ç”Ÿæˆè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Welcome to serverc.lab.example.com on 172.25.250.12</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>playbook ä¸­åŒ…å«ä¸€ä¸ª playï¼Œ è¯¥ play åœ¨ <code>webservers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šè¿è¡Œå¹¶å°†ä½¿ç”¨ <code>phpinfo</code> è§’è‰²ã€‚</p>
<ul>
<li>
<p>è¯·é€šè¿‡ URL /hello.php æµè§ˆåˆ° <code>webservers</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºå°†ç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello PHP World from FQDN</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å…¶ä¸­ï¼Œ<code>FQDN</code> æ˜¯ä¸»æœºçš„å®Œå…¨é™å®šåç§°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello PHP World from serverb.lab.example.com</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜æœ‰ PHP é…ç½®çš„å„ç§è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å®‰è£…çš„ PHP ç‰ˆæœ¬ç­‰ã€‚</p>
</li>
<li>
<p>åŒæ ·ï¼Œæµè§ˆåˆ° <code>http://172.25.250.12/hello.php</code> ä¼šç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello PHP World from serverc.lab.example.com</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜æœ‰ PHP é…ç½®çš„å„ç§è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å®‰è£…çš„ PHP ç‰ˆæœ¬ç­‰ã€‚</p>
</li>
</ul>
</li>
</ol>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<p>è¿™ä¸ªé¢˜ç›®ä¸­ä¸¤æ¡ä»»åŠ¡ä¸‹çš„è¦æ±‚çœ‹ç€æŒºå¤šæŒºå¤æ‚çš„ï¼Œç„¶è€Œä»–ä»¬åœ¨æ‰€ç»™çš„è§’è‰²åŒ…ä¸­éƒ½å·²è¿›è¡Œäº†é…ç½®ï¼Œæˆ‘ä»¬è¦åšçš„åªæ˜¯ç¼–å†™ playbook å»ä½¿ç”¨ä¸¤ä¸ªè§’è‰²åŒ…è€Œå·²ã€‚</p>
<ol>
<li>æ ¹æ®é¢˜ç›®è¦æ±‚åˆ›å»ºå¹¶ç¼–è¾‘ playbook</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/roles.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">and</span> <span class="string">Setup</span> <span class="string">Balancers</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">balancers</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">balancer</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">and</span> <span class="string">Setup</span> <span class="string">Phpinfo</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">phpinfo</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ‰§è¡Œå‰§æœ¬å¹¶éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/roles.yml</span><br><span class="line">[greg@control ansible]$ curl http://node5Â Â Â Â <span class="comment"># ä¼šçœ‹åˆ°è´Ÿè´£å‡è¡¡è½®ç•ªä» node3 å’Œ node4 è·å¾— web é¡µé¢</span></span><br><span class="line">[greg@control ansible]$ curl http://node3/hello.php</span><br><span class="line">[greg@control ansible]$ curl http://node4/hello.php</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå’Œä½¿ç”¨é€»è¾‘å·">åˆ›å»ºå’Œä½¿ç”¨é€»è¾‘å·</h3>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>/home/greg/ansible/lv.yml</code> çš„ playbook ï¼Œå®ƒå°†åœ¨æ‰€æœ‰å—ç®¡èŠ‚ç‚¹ä¸Šè¿è¡Œä»¥æ‰§è¡Œä¸‹åˆ—ä»»åŠ¡ï¼š</p>
<p>åˆ›å»ºç¬¦åˆä»¥ä¸‹è¦æ±‚çš„é€»è¾‘å·ï¼š</p>
<ul>
<li>é€»è¾‘å·åˆ›å»ºåœ¨ <code>research</code> å·ç»„ä¸­ï¼›</li>
<li>é€»è¾‘å·åç§°ä¸º <code>data</code>;</li>
<li>é€»è¾‘å·å¤§å°ä¸º <code>1500 MiB</code>;</li>
<li>ä½¿ç”¨ <code>ext4</code> æ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–é€»è¾‘å·ï¼›</li>
<li>å¦‚æœæ— æ³•åˆ›å»ºè¯·æ±‚çš„é€»è¾‘å·å¤§å°ï¼Œåº”æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”åº”æ”¹ä¸ºä½¿ç”¨å¤§å° <code>800 MiB</code>:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not create logical volume of that size</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœå·ç»„ <code>research</code> ä¸å­˜åœ¨ï¼Œåº”æ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Volume group <span class="keyword">done</span> not exist</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸è¦ä»¥ä»»ä½•æ–¹å¼æŒ‚è½½é€»è¾‘å·ã€‚</li>
</ul>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºå‰§æœ¬å¹¶ç¼–è¾‘ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/lv.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">and</span> <span class="string">Use</span> <span class="string">LV</span> <span class="string">on</span> <span class="string">ALL</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">and</span> <span class="string">Use</span> <span class="string">LV</span> <span class="string">on</span> <span class="string">ALL</span></span><br><span class="line">      <span class="attr">block:</span>    <span class="comment"># ä»»åŠ¡å—ï¼Œè¿™é‡Œé¢çš„ä»»åŠ¡æ‰§è¡Œä¸æˆåŠŸå°±ä¼šæ‰§è¡Œ rescue å—é‡Œçš„</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Execute</span> <span class="string">General</span> <span class="string">Steps</span>        </span><br><span class="line">          <span class="attr">lvol:</span> </span><br><span class="line">            <span class="attr">vg:</span> <span class="string">research</span></span><br><span class="line">            <span class="attr">lv:</span> <span class="string">data</span></span><br><span class="line">            <span class="attr">size:</span> <span class="string">1500m</span></span><br><span class="line">          <span class="attr">ignore_errors:</span> <span class="literal">yes</span>  <span class="comment"># å¿½ç•¥é”™è¯¯å»æ‰§è¡Œ rescue å—çš„</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">rescue:</span>    <span class="comment"># æ•‘æ´å—ï¼Œblock å—é‡Œæ­¥éª¤å¤±è´¥çš„è¡¥æ•‘æªæ–½</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Execute</span> <span class="string">Rescue</span> <span class="string">Steps</span> <span class="bullet">-</span> <span class="string">Show</span> <span class="string">Error</span> <span class="string">Message</span></span><br><span class="line">          <span class="attr">debug:</span></span><br><span class="line">            <span class="attr">msg:</span> <span class="string">Could</span> <span class="string">not</span> <span class="string">create</span> <span class="string">logical</span> <span class="string">volume</span> <span class="string">of</span> <span class="string">that</span> <span class="string">size</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Execute</span> <span class="string">Rescue</span> <span class="string">Steps</span> <span class="bullet">-</span> <span class="string">Plan</span> <span class="string">B</span></span><br><span class="line">          <span class="attr">lvol:</span></span><br><span class="line">            <span class="attr">vg:</span> <span class="string">research</span></span><br><span class="line">            <span class="attr">lv:</span> <span class="string">data</span></span><br><span class="line">            <span class="attr">size:</span> <span class="string">800m</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">always:</span>    <span class="comment"># æ— è®º block å¤±è´¥ä¸å¦éƒ½ä¼šæ‰§è¡Œçš„</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Formating</span> <span class="string">LV</span> <span class="string">to</span> <span class="string">Ext4</span></span><br><span class="line">          <span class="attr">filesystem:</span></span><br><span class="line">            <span class="attr">dev:</span> <span class="string">/dev/research/data</span></span><br><span class="line">            <span class="attr">fstype:</span> <span class="string">ext4</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot; &#x27;research&#x27; in ansible_lvm.vgs&quot;</span>    <span class="comment"># åˆ¤æ–­ï¼šå½“æœ‰ research vg æ‰æ‰§è¡Œä¸Šè¿°ä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Show</span> <span class="string">Error</span> <span class="string">Message</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line">        <span class="attr">msg:</span> <span class="string">Volume</span> <span class="string">group</span> <span class="string">done</span> <span class="string">not</span> <span class="string">exist</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">&quot; &#x27;research&#x27; not in ansible_lvm.vgs &quot;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ‰§è¡Œå‰§æœ¬å¹¶éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/lv.yml</span><br><span class="line">[greg@control ansible]$ ansible all -a <span class="string">&quot;lvs&quot;</span>Â Â Â Â <span class="comment"># éªŒè¯</span></span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆ-hosts-æ–‡ä»¶">ç”Ÿæˆ hosts æ–‡ä»¶</h3>
<ul>
<li>å°†ä¸€ä¸ªåˆå§‹æ¨¡æ¿æ–‡ä»¶ä» <code>http://materials/hosts.j2</code> ä¸‹è½½åˆ° <code>/home/greg/ansible</code>;</li>
<li>å®Œæˆè¯¥æ¨¡æ¿ï¼Œä»¥ä¾¿ç”¨å®ƒç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼šé’ˆå¯¹æ¯ä¸ªæ¸…å•ä¸»æœºåŒ…å«ä¸€è¡Œå†…å®¹ï¼Œå…¶æ ¼å¼ä¸ <code>/etc/hosts</code> ç›¸åŒï¼›</li>
<li>åˆ›å»ºåä¸º <code>/home/greg/ansible/hosts.yml</code> çš„ playbook ï¼Œå®ƒå°†ä½¿ç”¨æ­¤æ¨¡æ¿åœ¨ <code>dev</code> ä¸»æœºç»„ä¸­çš„ä¸»æœºä¸Šç”Ÿæˆæ–‡ä»¶ <code>/etc/myhosts</code>;</li>
<li>è¯¥ playbook è¿è¡Œåï¼Œ <code>dev</code> ä¸»æœºç»„ä¸­ä¸»æœºä¸Šçš„æ–‡ä»¶ <code>/etc/myhosts</code> åº”é’ˆå¯¹æ¯ä¸ªå—ç®¡ä¸»æœºåŒ…å«ä¸€è¡Œå†…å®¹ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP_ADDRESS FQDN HOSTNAME</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒIP_ADDRESS ä»£è¡¨æœ¬æœº ipï¼ŒFQDN ä»£è¡¨æœ¬æœºå®Œå…¨é™å®šåŸŸåï¼ŒHOSTNAME ä»£è¡¨æœ¬æœºä¸»æœºåã€‚</p>
<p>æ³¨ï¼šæ¸…å•ä¸»æœºåç§°çš„æ˜¾ç¤ºé¡ºåºä¸é‡è¦ã€‚</p>
<p>ğŸ’¯ <strong>ç­”æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ä¸‹è½½å¹¶æŸ¥çœ‹æ¨¡æ¿æ–‡ä»¶ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ wget http://materials/host.j2 -p /home/greg/ansible/ </span><br><span class="line">[greg@control ~]$ <span class="built_in">cat</span> /home/greg/ansible/hosts.j2</span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ç¼–è¾‘æ¨¡æ¿æ–‡ä»¶ï¼Œå‘å…¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for host in groups.all %&#125;</span><br><span class="line">&#123;&#123; hostvars[host].ansible_default_ipv4.address &#125;&#125; &#123;&#123; hostvars[host].ansible_fqdn &#125;&#125; &#123;&#123; hostvars[host].ansible_hostname &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç¼–å†™å‰§æœ¬ï¼Œå®Œæˆä»»åŠ¡ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ~]$ vim /home/greg/ansible/hosts.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Gather</span> <span class="string">Facts</span> <span class="string">of</span> <span class="string">All</span>    <span class="comment"># è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œæœ‰è¿™æ¡æ‰ä¼šè·å–æ‰€æœ‰ä¸»æœºçš„ facts</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Main</span> <span class="string">Task</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">myhosts</span> <span class="string">from</span> <span class="string">template</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/home/greg/ansible/hosts.j2</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/myhosts</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æ‰§è¡Œå‰§æœ¬å¹¶éªŒè¯ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[greg@control ansible]$ ansible-playbook /home/greg/ansible/hosts.yml</span><br><span class="line">[greg@control ansible]$ ansible dev -a <span class="string">&quot;cat /etc/myhosts&quot;</span>    <span class="comment"># éªŒè¯</span></span><br></pre></td></tr></table></figure>

        </div>
        
<blockquote class="copyright">
    <p><strong>æœ¬æ–‡é“¾æ¥ : </strong><a class="permalink" href="https://skinyi.github.io/2022-08-29-Linux%20|%20RHCE8%20%E8%80%83%E5%89%8D%E7%BB%83%E4%B9%A0%E9%A2%98%E5%8F%8A%E7%AD%94%E6%A1%88%EF%BC%88%E4%B8%8A%EF%BC%89.html">https://skinyi.github.io/2022-08-29-Linux | RHCE8 è€ƒå‰ç»ƒä¹ é¢˜åŠç­”æ¡ˆï¼ˆä¸Šï¼‰.html</a></p>
    <p><strong>è¿™ç¯‡æ–‡ç« ç”±ä½œè€…èƒ¡ç¼–ä¹±é€ æˆ–è€…ç”±å…¶ä»–æ–‡ç« å¤åˆ¶ç²˜è´´è€Œæ¥ï¼Œå…¶ä¸­æœ‰äº›å†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ï¼Œè¯·è°¨æ…å‚è€ƒå¤åˆ¶æ–‡ç« ä¸­çš„å†…å®¹ã€‚</strong></p>
</blockquote>


    </article>
    
    <section id="comments">
        
    </section>


    

</main>


<aside style="" id="sidebar" class="aside aside-fixture">
    <div class="toc-sidebar">
        <nav id="toc" class="article-toc">
            <h3 class="toc-title">æ–‡ç« ç›®å½•</h3>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">å¸¸è§„é¢˜ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE-Ansible"><span class="toc-number">1.1.</span> <span class="toc-text">å®‰è£…å’Œé…ç½® Ansible</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E8%BF%90%E8%A1%8C-Ansible-%E4%B8%B4%E6%97%B6%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">åˆ›å»ºå’Œè¿è¡Œ Ansible ä¸´æ—¶å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">1.3.</span> <span class="toc-text">å®‰è£…è½¯ä»¶åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-RHEL-%E7%B3%BB%E7%BB%9F%E8%A7%92%E8%89%B2"><span class="toc-number">1.4.</span> <span class="toc-text">ä½¿ç”¨ RHEL ç³»ç»Ÿè§’è‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Ansible-Galaxy-%E5%AE%89%E8%A3%85%E8%A7%92%E8%89%B2"><span class="toc-number">1.5.</span> <span class="toc-text">ä½¿ç”¨ Ansible Galaxy å®‰è£…è§’è‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E8%A7%92%E8%89%B2"><span class="toc-number">1.6.</span> <span class="toc-text">åˆ›å»ºå’Œä½¿ç”¨è§’è‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E-Ansible-Galaxy-%E4%BD%BF%E7%94%A8%E8%A7%92%E8%89%B2"><span class="toc-number">1.7.</span> <span class="toc-text">ä» Ansible Galaxy ä½¿ç”¨è§’è‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-number">1.8.</span> <span class="toc-text">åˆ›å»ºå’Œä½¿ç”¨é€»è¾‘å·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90-hosts-%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.</span> <span class="toc-text">ç”Ÿæˆ hosts æ–‡ä»¶</span></a></li></ol></li></ol>
        </nav>
    </div>
</aside>





        </section>
        <footer class="hidden lg:block fixed bottom-0 left-0 sm:w-1/12 bg-gray-100 z-40">
    
    
        <p class="footer-custom">â¤ Powered by <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> with <a href="https://github.com/fengkx/hexo-theme-purer" target="_blank" rel="noopener noreferrer">Purer theme</a>.</p>
    
</footer>

        <div id="mask" class="hidden mask fixed inset-0 bg-gray-900 opacity-75 z-40"></div>
        <div id="search-view-container" class="hidden shadow-xl"></div>
        
<script src="/js/dom-event.min.js"></script>



<script src="/js/local-search.min.js"></script>



    <script src="//cdn.jsdelivr.net/npm/lightgallery.js@1.1.3/dist/js/lightgallery.min.js"></script>
    
<script src="/js/light-gallery.min.js"></script>






    </body>
</html>
